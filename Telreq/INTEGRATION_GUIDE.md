# Telreq - 標準電話アプリとの統合ガイド

## 概要
TelreqはCallKitとAVAudioSessionを使用して、iOSの標準電話アプリと完全に両立可能な設計になっています。

## 動作フロー

### 📞 着信時の自動録音
1. **CallKit監視** → 着信検知
2. **自動権限チェック** → マイク・音声認識権限確認
3. **録音自動開始** → バックグラウンドで録音開始
4. **通話終了検知** → 自動で録音停止
5. **AI処理実行** → テキスト化・要約・TODO抽出

### 📱 発信時の録音
1. **事前録音開始** → Telreqで録音ボタンタップ
2. **標準アプリ連携** → 電話アプリで発信
3. **統合録音** → 通話全体を録音
4. **自動処理** → 終了時にAI処理実行

## 技術的な両立性

### ✅ 両立できる理由
- **CallKit統合**: システムレベルでの通話監視
- **共有AudioSession**: 音声リソースの適切な管理
- **権限ベース動作**: 必要な権限のみ使用
- **非侵入的設計**: 標準アプリの動作を妨げない

### ⚠️ 注意事項
- **権限必須**: マイク使用許可・音声認識許可
- **プライバシー**: 相手方への録音告知推奨
- **バックグラウンド制限**: iOS制限により処理時間に制約
- **メモリ管理**: 長時間録音時のメモリ使用量注意

## 設定手順

### 1. 権限設定
```swift
// Info.plistに追加必要
NSMicrophoneUsageDescription = "通話録音機能に使用"
NSSpeechRecognitionUsageDescription = "音声のテキスト化に使用"
```

### 2. 自動録音の有効化
- Telreqアプリでバックグラウンド録音を有効にする
- 通話監視機能をONにする
- AI処理設定を確認する

### 3. 使用方法
#### 着信応答時
- 普通に電話に出る → 自動で録音開始
- 通話終了 → 自動でテキスト化・要約

#### 発信時
- Telreq起動 → 録音ボタンタップ
- 電話アプリで発信・通話
- 通話終了 → 録音停止・処理開始

## トラブルシューティング

### 録音されない場合
1. **権限確認**: 設定 > プライバシー > マイク > Telreq
2. **音声認識権限**: 設定 > プライバシー > 音声認識
3. **バックグラウンド更新**: 設定 > Telreq > バックグラウンド更新

### 処理が重い場合
1. **メモリ不足**: アプリ再起動
2. **ネットワーク遅延**: WiFi/4G確認
3. **ローカル処理**: AI処理をローカルに切り替え

## 法的・コンプライアンス注意事項

### 個人利用
- 相手方への録音告知を推奨
- プライベート通話の適切な管理

### 企業利用
- 社内コンプライアンス規定の確認
- 顧客通話録音の法的許可
- データ保護・プライバシーポリシー準拠

## 技術サポート
- GitHub Issues: 技術的な問題報告
- ドキュメント: 詳細な設定方法
- ログ確認: アプリ内デバッグログ機能使用